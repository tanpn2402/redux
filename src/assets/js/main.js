/*global define*/
"use strict";

// polyfill
import "babel-polyfill";
import "canvas-5-polyfill"; // For IE
// requestAnimationFrame polyfill
import requestFrame from 'request-frame';
requestFrame('native');

// css
import "../css/chart_hist.css";

// react element
import React from "react";
import { render } from "react-dom";

// TTL element
import TTLChart from "./TTLChart"
import TTLChartControl from "./TTLChartControl"
import TTLChartEditControl from "./TTLChartEditControl"

//window.chartMethod = {};
//var chartMethod = window.chartMethod;
(function(window){

console.log('TTLStockChartInit');
window.TTLStockChart = TTLStockChart;

function TTLStockChart(pChartElement, pChartCtrlElement)
{
    if (!pChartCtrlElement)
    {
        render(
            <div id="hihi">
                <div id="TTLStockChart_C_Main" className="TTLStockChart_C_Main" />
                <div id="TTLStockChart_C_Ctl" className="TTLStockChart_C_Ctl" />
                <div id="TTLStockChart_C_EditCtl" className="TTLStockChart_C_EditCtl" />
            </div>
        , document.getElementById(pChartElement));
        this.mvChartElement = "TTLStockChart_C_Main";
        this.mvChartCtrlElement = "TTLStockChart_C_Ctl";
        this.mvChartEditCtrlElement = "TTLStockChart_C_EditCtl";
        // setScroll();
    }
    else
    {
        this.mvChartElement = pChartElement;
        this.mvChartCtrlElement = pChartCtrlElement;
    }
}

function init()
{
    // setScroll();
}

TTLStockChart.prototype.setChartHeight = function(pHeight)
{
    this.mvChartHeight = pHeight;
}

TTLStockChart.prototype.setChartWidth = function(pWidth)
{
    this.mvChartWidth = pWidth;
}

TTLStockChart.prototype.showChartControl = function (pShow)
{
    if (pShow)
        document.getElementById(this.mvChartCtrlElement).style.display = "";
    else
        document.getElementById(this.mvChartCtrlElement).style.display = "none";
}

TTLStockChart.prototype.drawChart = function(pData)
{
    // Point format: ["yyyy-MM-dd HH:mm:ss",close,high,low,open,volume]
    // {data:[[p1],[p2],[p3]]}
        
    if (pData === undefined || pData.data.length == 0)
    {
        if (this.chartRdrObj)
            document.getElementById(chartMethod.mvChartElement).style.display = "none";
        return;
    }
    
    var rawData = pData.data;
    if (this.chartRdrObj)
    {
        document.getElementById(chartMethod.mvChartElement).style.display = "";
        this.chartObj.setRawData(rawData);
    }
    else
    {
        if (this.mvChartHeight === undefined)
        {
            console.error("TTLStockChart: Chart height not set!");
            return;
        }
        
        if (!this.mvChartWidth)
        {
            var FitWidthChart = TTLChart.fitWidth(TTLChart);
            // change the type from hybrid to svg to compare the performance between svg and canvas
            this.chartRdrObj = render(<FitWidthChart height={this.mvChartHeight} rawData={rawData} />, document.getElementById(this.mvChartElement));
            this.chartObj = this.chartRdrObj.getWrappedInstance();
        }
        else
        {
            this.chartRdrObj = render(<TTLChart width={this.mvChartWidth} ratio={1} height={this.mvChartHeight} rawData={rawData} />, document.getElementById(this.mvChartElement));
            this.chartObj = this.chartRdrObj;
        }
        this.addData = this.chartObj.addRawData;
        this.setChartType = this.chartObj.setChartType;
        // this.setMainChartSeries = this.chartObj.setMainChartSeries;
        // this.setSubCharts = this.chartObj.setSubCharts;
        // this.refreshChart = this.chartObj.refresh;
    }
    
    if (!this.firstDraw)
    {
        this.firstDraw = true;
        this.chartCtrl = render(<TTLChartControl chartMethod={this}/>, document.getElementById(this.mvChartCtrlElement));
        this.refreshChartCtrl = this.chartCtrl.refresh;
        
        this.chartEditCtrl = render(<TTLChartEditControl chartMethod={this}/>, document.getElementById(this.mvChartEditCtrlElement));
        // this.chartCtrl.setChartMethod(this);
        // this.chartCtrl.refreshState();
        // this.chartEditCtrl.setChartMethod(this);
        
        this.importState = this.chartCtrl.importState;
    }
}

TTLStockChart.prototype.testChart = function (pTestChartID)
{
    var lvTestChart;
    
    // http://www.nasdaq.com/quotes/historical-quotes.aspx
    if (pTestChartID == 0) // GOOG 3-Month [2016-09-16 - 2016-12-16]
        lvTestChart = {data:[['2016-09-16 00:00:00',768.88,769.75,764.66,769.75,2047036],['2016-09-19 00:00:00',765.7,774,764.4406,772.42,1171969],['2016-09-20 00:00:00',771.41,773.33,768.53,769,975434],['2016-09-21 00:00:00',776.22,777.16,768.301,772.66,1166290],['2016-09-22 00:00:00',787.21,789.85,778.44,780,1483899],['2016-09-23 00:00:00',786.9,788.93,784.15,786.59,1411439],['2016-09-26 00:00:00',774.21,782.74,773.07,782.74,1531788],['2016-09-27 00:00:00',783.01,785.9899,774.308,775.5,1152760],['2016-09-28 00:00:00',781.56,781.81,774.97,777.85,1108249],['2016-09-29 00:00:00',775.01,785.8,774.232,781.44,1310252],['2016-09-30 00:00:00',777.29,780.94,774.09,776.33,1583293],['2016-10-03 00:00:00',772.56,776.065,769.5,774.25,1276614],['2016-10-04 00:00:00',776.43,778.71,772.89,776.03,1198361],['2016-10-05 00:00:00',776.47,782.07,775.65,779.31,1457661],['2016-10-06 00:00:00',776.86,780.48,775.54,779,1066910],['2016-10-07 00:00:00',775.08,779.66,770.75,779.66,932444],['2016-10-10 00:00:00',785.94,789.38,775.87,777.71,1161410],['2016-10-11 00:00:00',783.07,792.28,780.58,786.66,1371461],['2016-10-12 00:00:00',786.14,788.13,782.06,783.76,935138],['2016-10-13 00:00:00',778.19,781.22,773,781.22,1360619],['2016-10-14 00:00:00',778.53,783.95,776,781.65,851512],['2016-10-17 00:00:00',779.96,785.85,777.5,779.8,1091524],['2016-10-18 00:00:00',795.26,801.61,785.565,787.85,2046338],['2016-10-19 00:00:00',801.56,804.63,797.635,798.86,1762990],['2016-10-20 00:00:00',796.97,803.97,796.03,803.3,1755546],['2016-10-21 00:00:00',799.37,799.5,794,795,1262042],['2016-10-24 00:00:00',813.11,815.18,804.82,804.9,1693162],['2016-10-25 00:00:00',807.67,816.68,805.14,816.68,1575020],['2016-10-26 00:00:00',799.07,806.98,796.32,806.34,1645403],['2016-10-27 00:00:00',795.35,803.49,791.5,801,2723097],['2016-10-28 00:00:00',795.37,815.49,793.59,808.35,4261912],['2016-10-31 00:00:00',784.54,796.86,784,795.47,2420892],['2016-11-01 00:00:00',783.61,789.49,775.54,782.89,2404898],['2016-11-02 00:00:00',768.7,781.65,763.4496,778.2,1905814],['2016-11-03 00:00:00',762.13,769.95,759.03,767.25,1933937],['2016-11-04 00:00:00',762.02,770.36,750.5611,750.66,2131948],['2016-11-07 00:00:00',782.52,785.19,772.55,774.5,1574426],['2016-11-08 00:00:00',790.51,795.633,780.19,783.4,1361472],['2016-11-09 00:00:00',785.31,791.2265,771.67,779.94,2603860],['2016-11-10 00:00:00',762.56,791.17,752.18,791.17,4733916],['2016-11-11 00:00:00',754.02,760.78,750.38,756.54,2421889],['2016-11-14 00:00:00',736.08,757.85,727.54,755.6,3644965],['2016-11-15 00:00:00',758.49,764.4162,746.97,746.97,2375056],['2016-11-16 00:00:00',764.48,766.36,750.51,755.2,1468196],['2016-11-17 00:00:00',771.23,772.7,764.23,766.92,1298484],['2016-11-18 00:00:00',760.54,775,760,771.37,1528555],['2016-11-21 00:00:00',769.2,769.7,760.6,762.61,1324431],['2016-11-22 00:00:00',768.27,776.96,767,772.63,1592372],['2016-11-23 00:00:00',760.99,768.2825,755.25,767.73,1477501],['2016-11-25 00:00:00',761.68,765,760.52,764.26,587421],['2016-11-28 00:00:00',768.24,779.53,759.8,760,2177039],['2016-11-29 00:00:00',770.84,778.5,768.24,771.53,1616427],['2016-11-30 00:00:00',758.04,772.99,754.83,770.07,2386628],['2016-12-01 00:00:00',747.92,759.85,737.0245,757.44,3017001],['2016-12-02 00:00:00',750.5,754,743.1,744.59,1452181],['2016-12-05 00:00:00',762.52,763.9,752.9,757.71,1393566],['2016-12-06 00:00:00',759.11,768.83,757.34,764.73,1690365],['2016-12-07 00:00:00',771.19,771.36,755.8,761,1757710],['2016-12-08 00:00:00',776.42,778.18,767.23,772.48,1487517],['2016-12-09 00:00:00',789.29,789.43,779.021,780,1821146],['2016-12-12 00:00:00',789.27,791.25,784.3554,785.04,2102288],['2016-12-13 00:00:00',796.1,804.3799,793.34,793.9,2122735],['2016-12-14 00:00:00',797.07,804,794.01,797.4,1700875],['2016-12-15 00:00:00',797.85,803,792.92,797.34,1623709],['2016-12-16 00:00:00',790.8,800.8558,790.29,800.4,2435100]]};
    else if (pTestChartID == 1) // AAPL 3-Month [2016-09-16 - 2016-12-16]
        lvTestChart = {data:[['2016-09-16 00:00:00',114.92,116.13,114.04,115.12,79763890],['2016-09-19 00:00:00',113.58,116.18,113.25,115.19,46937190],['2016-09-20 00:00:00',113.57,114.12,112.51,113.05,34494150],['2016-09-21 00:00:00',113.55,113.989,112.441,113.85,35951900],['2016-09-22 00:00:00',114.62,114.94,114,114.35,31048170],['2016-09-23 00:00:00',112.71,114.79,111.55,114.42,52411070],['2016-09-26 00:00:00',112.88,113.39,111.55,111.64,29800240],['2016-09-27 00:00:00',113.09,113.18,112.34,113,24587490],['2016-09-28 00:00:00',113.95,114.64,113.43,113.69,29608390],['2016-09-29 00:00:00',112.18,113.8,111.8,113.16,35850010],['2016-09-30 00:00:00',113.05,113.37,111.8,112.46,36340670],['2016-10-03 00:00:00',112.52,113.05,112.28,112.71,21634520],['2016-10-04 00:00:00',113,114.31,112.63,113.06,29707270],['2016-10-05 00:00:00',113.05,113.66,112.69,113.4,21400410],['2016-10-06 00:00:00',113.89,114.34,113.13,113.7,28508710],['2016-10-07 00:00:00',114.06,114.56,113.51,114.31,24336440],['2016-10-10 00:00:00',116.05,116.75,114.72,115.02,36087910],['2016-10-11 00:00:00',116.3,118.69,116.2,117.7,63963010],['2016-10-12 00:00:00',117.34,117.98,116.75,117.35,37512930],['2016-10-13 00:00:00',116.98,117.44,115.72,116.79,35041820],['2016-10-14 00:00:00',117.63,118.17,117.13,117.88,35626020],['2016-10-17 00:00:00',117.55,117.84,116.78,117.33,23583810],['2016-10-18 00:00:00',117.47,118.21,117.45,118.18,24308210],['2016-10-19 00:00:00',117.12,117.76,113.8,117.25,19977160],['2016-10-20 00:00:00',117.06,117.38,116.33,116.86,24100150],['2016-10-21 00:00:00',116.6,116.91,116.28,116.81,22527690],['2016-10-24 00:00:00',117.65,117.74,117,117.1,23492650],['2016-10-25 00:00:00',118.25,118.36,117.31,117.95,46820600],['2016-10-26 00:00:00',115.59,115.7,113.31,114.31,66028640],['2016-10-27 00:00:00',114.48,115.86,114.1,115.39,31396130],['2016-10-28 00:00:00',113.72,115.21,113.45,113.87,36792100],['2016-10-31 00:00:00',113.54,114.23,113.2,113.65,26378910],['2016-11-01 00:00:00',111.49,113.77,110.53,113.46,43403760],['2016-11-02 00:00:00',111.59,112.35,111.23,111.4,28174980],['2016-11-03 00:00:00',109.83,111.46,109.55,110.98,26538700],['2016-11-04 00:00:00',108.84,110.25,108.11,108.53,30790930],['2016-11-07 00:00:00',110.41,110.51,109.46,110.08,32361930],['2016-11-08 00:00:00',111.06,111.72,109.7,110.31,24129630],['2016-11-09 00:00:00',110.88,111.32,108.05,109.88,59118740],['2016-11-10 00:00:00',107.79,111.09,105.83,111.09,57097740],['2016-11-11 00:00:00',108.43,108.87,106.55,107.12,34117030],['2016-11-14 00:00:00',105.71,107.809,104.08,107.71,50901380],['2016-11-15 00:00:00',107.11,107.68,106.1593,106.57,32230590],['2016-11-16 00:00:00',109.99,110.23,106.6,106.7,58724080],['2016-11-17 00:00:00',109.95,110.35,108.83,109.81,27623150],['2016-11-18 00:00:00',110.06,110.54,109.66,109.72,28310840],['2016-11-21 00:00:00',111.73,111.99,110.01,110.12,29164190],['2016-11-22 00:00:00',111.8,112.42,111.4,111.95,25931710],['2016-11-23 00:00:00',111.23,111.51,110.33,111.36,27420550],['2016-11-25 00:00:00',111.79,111.87,110.95,111.13,11475920],['2016-11-28 00:00:00',111.57,112.465,111.39,111.43,27054320],['2016-11-29 00:00:00',111.46,112.03,110.07,110.78,28507780],['2016-11-30 00:00:00',110.52,112.2,110.27,111.6,36151450],['2016-12-01 00:00:00',109.49,110.94,109.03,110.365,37034520],['2016-12-02 00:00:00',109.9,110.09,108.85,109.17,26481320],['2016-12-05 00:00:00',109.11,110.03,108.25,110,34113880],['2016-12-06 00:00:00',109.95,110.36,109.19,109.5,26160560],['2016-12-07 00:00:00',111.03,111.19,109.16,109.26,29976030],['2016-12-08 00:00:00',112.12,112.43,110.6,110.86,27049830],['2016-12-09 00:00:00',113.95,114.7,112.31,112.31,34324350],['2016-12-12 00:00:00',113.3,115,112.49,113.29,26176690],['2016-12-13 00:00:00',115.19,115.92,113.75,113.84,43293350],['2016-12-14 00:00:00',115.19,116.2,114.98,115.04,33962370],['2016-12-15 00:00:00',115.82,116.73,115.23,115.38,46286150],['2016-12-16 00:00:00',115.97,116.5,115.645,116.47,44284660]]};
    else if (pTestChartID == 2) // MSFT 3-Month [2016-09-16 - 2016-12-16]
        lvTestChart = {data:[['2016-09-16 00:00:00',57.25,57.63,56.75,57.63,44603890],['2016-09-19 00:00:00',56.93,57.75,56.85,57.27,20919450],['2016-09-20 00:00:00',56.81,57.35,56.75,57.35,17347740],['2016-09-21 00:00:00',57.76,57.85,57.08,57.51,33623490],['2016-09-22 00:00:00',57.82,58,57.63,57.92,19821760],['2016-09-23 00:00:00',57.43,57.91,57.38,57.87,19941140],['2016-09-26 00:00:00',56.9,57.14,56.83,57.08,21184750],['2016-09-27 00:00:00',57.95,58.06,56.681,56.93,28029780],['2016-09-28 00:00:00',58.03,58.06,57.67,57.88,20523320],['2016-09-29 00:00:00',57.4,58.1679,57.21,57.81,25389600],['2016-09-30 00:00:00',57.6,57.77,57.34,57.57,29877820],['2016-10-03 00:00:00',57.42,57.55,57.06,57.405,19156410],['2016-10-04 00:00:00',57.24,57.595,56.97,57.27,20061950],['2016-10-05 00:00:00',57.64,57.9601,57.26,57.29,16708620],['2016-10-06 00:00:00',57.74,57.86,57.28,57.74,16194470],['2016-10-07 00:00:00',57.8,57.98,57.42,57.85,20062440],['2016-10-10 00:00:00',58.04,58.39,57.87,57.91,18085830],['2016-10-11 00:00:00',57.19,58.02,56.89,57.89,26483780],['2016-10-12 00:00:00',57.11,57.27,56.4,57.11,22157100],['2016-10-13 00:00:00',56.92,57.3,56.315,56.7,25217590],['2016-10-14 00:00:00',57.42,57.74,57.12,57.12,27221480],['2016-10-17 00:00:00',57.22,57.46,56.87,57.36,23829490],['2016-10-18 00:00:00',57.66,57.945,57.41,57.53,18862790],['2016-10-19 00:00:00',57.53,57.84,57.395,57.47,22840410],['2016-10-20 00:00:00',57.25,57.52,56.66,57.5,48880910],['2016-10-21 00:00:00',59.66,60.45,59.485,60.28,80008400],['2016-10-24 00:00:00',61,61,59.93,59.94,54039610],['2016-10-25 00:00:00',60.99,61.3699,60.8,60.85,35119480],['2016-10-26 00:00:00',60.63,61.2,60.47,60.81,29908240],['2016-10-27 00:00:00',60.1,60.83,60.09,60.61,28444550],['2016-10-28 00:00:00',59.87,60.52,59.58,60.01,33569190],['2016-10-31 00:00:00',59.92,60.42,59.92,60.16,26418340],['2016-11-01 00:00:00',59.8,60.02,59.25,59.97,24474870],['2016-11-02 00:00:00',59.43,59.93,59.3,59.82,22118490],['2016-11-03 00:00:00',59.21,59.64,59.11,59.53,21448620],['2016-11-04 00:00:00',58.71,59.28,58.52,58.65,28693430],['2016-11-07 00:00:00',60.42,60.52,59.78,59.78,31652340],['2016-11-08 00:00:00',60.47,60.78,60.15,60.55,22923800],['2016-11-09 00:00:00',60.17,60.59,59.2,60,49588490],['2016-11-10 00:00:00',58.7,60.49,57.6302,60.48,57770560],['2016-11-11 00:00:00',59.02,59.116,58.01,58.23,35932400],['2016-11-14 00:00:00',58.12,59.08,57.28,59.02,41248640],['2016-11-15 00:00:00',58.87,59.49,58.315,58.33,35850360],['2016-11-16 00:00:00',59.65,59.66,58.81,58.94,27329530],['2016-11-17 00:00:00',60.64,60.95,59.965,60.41,32084890],['2016-11-18 00:00:00',60.35,61.14,60.3,60.78,27210170],['2016-11-21 00:00:00',60.86,60.97,60.42,60.5,19638240],['2016-11-22 00:00:00',61.12,61.26,60.805,60.98,23205870],['2016-11-23 00:00:00',60.4,61.1,60.25,61.01,21847500],['2016-11-25 00:00:00',60.53,60.53,60.13,60.3,8409616],['2016-11-28 00:00:00',60.61,61.02,60.21,60.34,20604370],['2016-11-29 00:00:00',61.09,61.41,60.52,60.65,22365860],['2016-11-30 00:00:00',60.26,61.18,60.215,60.86,34641520],['2016-12-01 00:00:00',59.2,60.15,58.935,60.11,34518030],['2016-12-02 00:00:00',59.25,59.47,58.8,59.08,25464230],['2016-12-05 00:00:00',60.22,60.585,59.56,59.7,23552030],['2016-12-06 00:00:00',59.95,60.46,59.8,60.43,19966340],['2016-12-07 00:00:00',61.37,61.38,59.8,60.01,30807320],['2016-12-08 00:00:00',61.01,61.58,60.84,61.3,21201400],['2016-12-09 00:00:00',61.97,61.99,61.125,61.18,27337160],['2016-12-12 00:00:00',62.17,62.3,61.72,61.82,20186390],['2016-12-13 00:00:00',62.98,63.42,62.24,62.5,35072050],['2016-12-14 00:00:00',62.68,63.45,62.53,63,30335770],['2016-12-15 00:00:00',62.58,63.1535,62.3,62.7,27661180],['2016-12-16 00:00:00',62.3,62.95,62.115,62.95,42452660]]};
    else if (pTestChartID == 3) // CSCO 3-Month [2016-09-16 - 2016-12-16]
        lvTestChart = {data:[['2016-09-16 00:00:00',30.84,31.14,30.7,31.12,37364950],['2016-09-19 00:00:00',31.02,31.25,30.82,30.85,16817940],['2016-09-20 00:00:00',31.1,31.22,31.04,31.08,15878660],['2016-09-21 00:00:00',31.36,31.38,30.97,31.11,21150600],['2016-09-22 00:00:00',31.66,31.8,31.49,31.5,20220880],['2016-09-23 00:00:00',31.34,31.8,31.31,31.71,20396720],['2016-09-26 00:00:00',31.07,31.16,30.79,31.1,20360660],['2016-09-27 00:00:00',31.48,31.61,30.96,31.09,17989390],['2016-09-28 00:00:00',31.5,31.59,31.3624,31.44,15815550],['2016-09-29 00:00:00',31.39,31.57,31.25,31.51,15383020],['2016-09-30 00:00:00',31.72,31.8,31.56,31.61,30065610],['2016-10-03 00:00:00',31.5,31.58,31.2,31.31,14055180],['2016-10-04 00:00:00',31.35,31.63,31.15,31.46,18445810],['2016-10-05 00:00:00',31.59,31.68,31.41,31.41,11760100],['2016-10-06 00:00:00',31.48,31.63,31.21,31.57,14049690],['2016-10-07 00:00:00',31.47,31.6,31.23,31.48,13071840],['2016-10-10 00:00:00',31.47,31.68,31.44,31.54,12730130],['2016-10-11 00:00:00',31.04,31.53,30.85,31.52,19357340],['2016-10-12 00:00:00',30.34,30.63,29.94,30.53,36856250],['2016-10-13 00:00:00',30.17,30.25,29.86,30.09,24260860],['2016-10-14 00:00:00',30.18,30.55,30.16,30.35,20541100],['2016-10-17 00:00:00',30.22,30.42,30.1,30.13,13957020],['2016-10-18 00:00:00',30.44,30.69,30.43,30.69,14434360],['2016-10-19 00:00:00',30.35,30.45,30.19,30.44,14809130],['2016-10-20 00:00:00',30.16,30.3736,30.04,30.28,17295040],['2016-10-21 00:00:00',30.15,30.2,29.92,30.01,15119660],['2016-10-24 00:00:00',30.46,30.5,30.3,30.341,14084340],['2016-10-25 00:00:00',30.34,30.51,30.23,30.5,15226950],['2016-10-26 00:00:00',30.55,30.86,30.32,30.59,17988710],['2016-10-27 00:00:00',30.38,30.67,30.355,30.595,16905280],['2016-10-28 00:00:00',30.59,30.8,30.35,30.36,19921200],['2016-10-31 00:00:00',30.68,30.77,30.32,30.34,23225250],['2016-11-01 00:00:00',30.48,30.86,30.23,30.85,17508320],['2016-11-02 00:00:00',30.39,30.68,30.23,30.43,19151160],['2016-11-03 00:00:00',30.32,30.56,30.24,30.5,15917790],['2016-11-04 00:00:00',30.19,30.495,29.63,29.98,18501660],['2016-11-07 00:00:00',30.94,31.06,30.61,30.71,23006160],['2016-11-08 00:00:00',31,31.195,30.725,30.94,19395500],['2016-11-09 00:00:00',31.36,31.49,30.7,31.04,38539660],['2016-11-10 00:00:00',31,31.76,30.81,31.41,38310820],['2016-11-11 00:00:00',31.36,31.47,30.92,30.93,23112370],['2016-11-14 00:00:00',31.37,31.67,31.35,31.43,22915860],['2016-11-15 00:00:00',31.7,31.85,31.27,31.27,24123140],['2016-11-16 00:00:00',31.57,31.89,31.51,31.62,26766990],['2016-11-17 00:00:00',30.05,30.05,29.61,29.91,75111620],['2016-11-18 00:00:00',30.18,30.36,30.005,30.11,38473050],['2016-11-21 00:00:00',30.05,30.33,30.01,30.3,27479020],['2016-11-22 00:00:00',29.89,30.19,29.85,30.08,26749840],['2016-11-23 00:00:00',29.71,29.95,29.56,29.83,24474820],['2016-11-25 00:00:00',30.09,30.145,29.55,29.6,17678860],['2016-11-28 00:00:00',29.92,30.09,29.82,30.08,21344630],['2016-11-29 00:00:00',29.83,30.1,29.79,29.94,23528350],['2016-11-30 00:00:00',29.82,29.95,29.68,29.76,26202860],['2016-12-01 00:00:00',29.45,29.85,29.4,29.84,25994460],['2016-12-02 00:00:00',29.25,29.56,29.12,29.31,27031950],['2016-12-05 00:00:00',29.53,29.6,29.29,29.33,20828650],['2016-12-06 00:00:00',29.33,29.59,29.24,29.42,27351220],['2016-12-07 00:00:00',29.95,30.04,29.32,29.48,30124320],['2016-12-08 00:00:00',29.95,30.33,29.92,30.11,21369810],['2016-12-09 00:00:00',30.06,30.07,29.73,29.98,21350030],['2016-12-12 00:00:00',30.17,30.2,30.025,30.08,17278880],['2016-12-13 00:00:00',30.59,30.64,30.2,30.3,24655770],['2016-12-14 00:00:00',30.46,31.065,30.41,30.6,27462640],['2016-12-15 00:00:00',30.63,30.8,30.505,30.59,20876050],['2016-12-16 00:00:00',30.59,30.72,30.2705,30.7,45873060]]};
    else if (pTestChartID == 4) // FB 3-Month [2016-09-16 - 2016-12-16]
        lvTestChart = {data:[['2016-09-16 00:00:00',129.07,129.18,128.2,128.2,24083560],['2016-09-19 00:00:00',128.65,129.94,128.26,129.91,14927990],['2016-09-20 00:00:00',128.64,129.17,128.0307,128.65,11076150],['2016-09-21 00:00:00',129.94,130.005,128.39,129.13,14045780],['2016-09-22 00:00:00',130.08,130.73,129.56,130.5,15358850],['2016-09-23 00:00:00',127.96,128.6,127.3,127.56,28293920],['2016-09-26 00:00:00',127.31,128.16,126.8,127.37,15041370],['2016-09-27 00:00:00',128.69,129.01,127.43,127.61,15600130],['2016-09-28 00:00:00',129.23,129.47,128.4,129.21,12035720],['2016-09-29 00:00:00',128.09,129.29,127.55,129.18,14489880],['2016-09-30 00:00:00',128.27,128.59,127.45,128.03,18392040],['2016-10-03 00:00:00',128.77,129.09,127.8,128.38,13134510],['2016-10-04 00:00:00',128.19,129.2765,127.5499,129.17,14294610],['2016-10-05 00:00:00',128.47,128.8,127.83,128.25,12354920],['2016-10-06 00:00:00',128.74,129.06,128.08,128.43,11673340],['2016-10-07 00:00:00',128.99,129.25,128.33,129.04,12800360],['2016-10-10 00:00:00',130.24,130.7,129.2,129.68,15113560],['2016-10-11 00:00:00',128.88,130.64,128.23,130.23,17508530],['2016-10-12 00:00:00',129.05,129.66,128.46,129.01,11043240],['2016-10-13 00:00:00',127.82,128.25,126.75,128.21,17106910],['2016-10-14 00:00:00',127.88,128.95,127.58,128.49,13335970],['2016-10-17 00:00:00',127.54,128.47,127.32,128.2,11317650],['2016-10-18 00:00:00',128.57,129.39,128.01,128.68,13487280],['2016-10-19 00:00:00',130.11,130.47,128.6,128.74,16723000],['2016-10-20 00:00:00',130,130.66,129.5,130.07,13148980],['2016-10-21 00:00:00',132.07,132.13,129.7,129.78,18983740],['2016-10-24 00:00:00',133.28,133.405,132.15,132.72,17420290],['2016-10-25 00:00:00',132.29,133.5,132.22,133.5,13307700],['2016-10-26 00:00:00',131.04,132.26,130.935,131.64,13066210],['2016-10-27 00:00:00',129.69,131.8,129.27,131.74,16628680],['2016-10-28 00:00:00',131.29,132.97,129.93,130.5,24500920],['2016-10-31 00:00:00',130.99,132.12,130.8835,132.01,15649280],['2016-11-01 00:00:00',129.5,131.94,128.65,131.41,21974210],['2016-11-02 00:00:00',127.17,130.23,126.28,130.23,43895660],['2016-11-03 00:00:00',120,123.28,119.5,122,63660540],['2016-11-04 00:00:00',120.75,121.93,119.25,119.59,30468330],['2016-11-07 00:00:00',122.15,123.2089,121.35,122.83,22957100],['2016-11-08 00:00:00',124.22,124.61,121.54,122.03,19391790],['2016-11-09 00:00:00',123.18,123.81,120.51,121.5,31883790],['2016-11-10 00:00:00',120.8,124.18,115.27,123.93,67808300],['2016-11-11 00:00:00',119.02,120.7,118.15,119.53,32814370],['2016-11-14 00:00:00',115.08,119.1256,113.5535,119.1256,51315610],['2016-11-15 00:00:00',117.2,118.49,115.83,116.73,34629110],['2016-11-16 00:00:00',116.34,117.88,114.21,114.48,32358800],['2016-11-17 00:00:00',117.79,117.79,116.01,116.81,18570820],['2016-11-18 00:00:00',117.02,119.13,116.84,118.39,22768330],['2016-11-21 00:00:00',121.77,121.95,117.8,118.2,35359460],['2016-11-22 00:00:00',121.47,122.98,120.9,122.4,26006340],['2016-11-23 00:00:00',120.84,121.31,119.94,121.23,15646580],['2016-11-25 00:00:00',120.38,121.14,120.07,121.01,8658605],['2016-11-28 00:00:00',120.41,121.69,119.82,120.12,18081770],['2016-11-29 00:00:00',120.87,122.1,120.4,120.57,18871130],['2016-11-30 00:00:00',118.42,121.79,117.95,120.32,30135230],['2016-12-01 00:00:00',115.1,118.45,114,118.38,43231480],['2016-12-02 00:00:00',115.4,116.48,114.3,115.11,25050450],['2016-12-05 00:00:00',117.43,117.57,115.07,115.95,20123920],['2016-12-06 00:00:00',117.31,117.795,116.33,117.69,19089060],['2016-12-07 00:00:00',117.95,117.95,116.57,117,21891800],['2016-12-08 00:00:00',118.91,119.5,117.64,117.98,22427310],['2016-12-09 00:00:00',119.68,119.94,118.95,119.22,17452710],['2016-12-12 00:00:00',117.77,119.24,117.65,119.22,17782470],['2016-12-13 00:00:00',120.31,121.52,117.61,117.86,29568990],['2016-12-14 00:00:00',120.21,121.69,118.85,120,25890630],['2016-12-15 00:00:00',120.57,122.5,119.63,120.08,20113550],['2016-12-16 00:00:00',119.87,121.5,119.27,120.9,25316220]]};
    else // Original test data [2016-01-01 - 2016-06-30]
        lvTestChart = {data:[['2016-01-01 00:00:00',58950.0,58950.0,58950.0,58950.0,17576883],['2016-01-02 00:00:00',58950.0,59050.0,58450.0,59000.0,17576883],['2016-01-03 00:00:00',59350.0,59550.0,58950.0,59250.0,24688561],['2016-01-04 00:00:00',58750.0,58900.0,58150.0,58300.0,22021929],['2016-01-05 00:00:00',58050.0,58350.0,57850.0,58150.0,18634915],['2016-01-06 00:00:00',57150.0,57850.0,56900.0,57600.0,35683352],['2016-01-07 00:00:00',58150.0,58450.0,57850.0,58400.0,17086662],['2016-01-08 00:00:00',58150.0,58400.0,57400.0,58300.0,28121293],['2016-01-09 00:00:00',58100.0,58650.0,57350.0,57500.0,30959678],['2016-01-10 00:00:00',57350.0,58300.0,57000.0,57500.0,33044980],['2016-01-11 00:00:00',58050.0,59000.0,57700.0,58750.0,44806106],['2016-01-12 00:00:00',58550.0,60150.0,58350.0,59800.0,43595992],['2016-01-13 00:00:00',59400.0,59850.0,58600.0,58700.0,34045815],['2016-01-14 00:00:00',58950.0,59250.0,58250.0,58550.0,31229119],['2016-01-15 00:00:00',58650.0,58850.0,57850.0,58350.0,38838762],['2016-01-16 00:00:00',58350.0,58500.0,57500.0,57500.0,22560247],['2016-01-17 00:00:00',57400.0,57850.0,57250.0,57500.0,38366574],['2016-01-18 00:00:00',58000.0,59100.0,58000.0,58800.0,29584063],['2016-01-19 00:00:00',58250.0,59400.0,58250.0,59050.0,41311377],['2016-01-20 00:00:00',59800.0,60450.0,59150.0,59400.0,44400613],['2016-01-21 00:00:00',59300.0,59600.0,58700.0,58750.0,42652309],['2016-01-22 00:00:00',59050.0,59850.0,59050.0,59500.0,42952358],['2016-01-23 00:00:00',59900.0,60450.0,59300.0,59950.0,33865710],['2016-01-24 00:00:00',59950.0,60600.0,59750.0,60150.0,41344771],['2016-01-25 00:00:00',59000.0,59800.0,59000.0,59000.0,57782797],['2016-01-26 00:00:00',59100.0,59500.0,57300.0,57450.0,66929272],['2016-01-27 00:00:00',57500.0,57800.0,56250.0,56400.0,48017413],['2016-01-28 00:00:00',56200.0,56450.0,55850.0,55900.0,25250148],['2016-01-29 00:00:00',55650.0,55950.0,55500.0,55800.0,12979109],['2016-01-30 00:00:00',55900.0,56000.0,55450.0,55450.0,15653855],['2016-01-31 00:00:00',55450.0,55850.0,55300.0,55450.0,20007306],['2016-02-01 00:00:00',55200.0,55300.0,54900.0,55200.0,12677738],['2016-02-02 00:00:00',55200.0,55250.0,54850.0,55050.0,12370154],['2016-02-03 00:00:00',55150.0,55150.0,54750.0,55000.0,11457146],['2016-02-04 00:00:00',54900.0,55500.0,54750.0,55500.0,13976388],['2016-02-05 00:00:00',55200.0,55500.0,54800.0,54800.0,23470279],['2016-02-06 00:00:00',54600.0,55000.0,54600.0,54650.0,28134050],['2016-02-07 00:00:00',54200.0,54600.0,53850.0,54400.0,19725679],['2016-02-08 00:00:00',54550.0,54850.0,54100.0,54650.0,18400121],['2016-02-09 00:00:00',54600.0,54800.0,54600.0,54600.0,15746455],['2016-02-10 00:00:00',54300.0,54800.0,53850.0,53900.0,22647825],['2016-02-11 00:00:00',54750.0,55000.0,54350.0,54550.0,23417108],['2016-02-12 00:00:00',54350.0,54550.0,54000.0,54500.0,18457886],['2016-02-13 00:00:00',54500.0,54650.0,53850.0,54000.0,30280680],['2016-02-14 00:00:00',53500.0,53850.0,53250.0,53300.0,34276558],['2016-02-15 00:00:00',53000.0,53250.0,52200.0,52350.0,47823582],['2016-02-16 00:00:00',51600.0,51800.0,49750.0,50000.0,56329544],['2016-02-17 00:00:00',50800.0,51100.0,50750.0,50800.0,20010122],['2016-02-18 00:00:00',50550.0,50600.0,50200.0,50300.0,22758976],['2016-02-19 00:00:00',50800.0,51000.0,50550.0,50700.0,21273412],['2016-02-20 00:00:00',50600.0,50750.0,50300.0,50600.0,25335740],['2016-02-21 00:00:00',50250.0,50750.0,49950.0,50000.0,23433937],['2016-02-22 00:00:00',50250.0,50400.0,50050.0,50350.0,12635677],['2016-02-23 00:00:00',50350.0,50400.0,50000.0,50250.0,13407251],['2016-02-24 00:00:00',50450.0,50750.0,50350.0,50500.0,22091667],['2016-02-25 00:00:00',50250.0,50450.0,49450.0,49500.0,26981365],['2016-02-26 00:00:00',49500.0,49800.0,49350.0,49600.0,16116949],['2016-02-27 00:00:00',49750.0,49900.0,49300.0,49400.0,20793265],['2016-02-28 00:00:00',49600.0,49800.0,49150.0,49450.0,30596735],['2016-02-29 00:00:00',49300.0,49500.0,48350.0,48600.0,29197715],['2016-03-01 00:00:00',48650.0,49050.0,48600.0,48750.0,26373435],['2016-03-02 00:00:00',48400.0,48600.0,48000.0,48100.0,35820363],['2016-03-03 00:00:00',47600.0,47800.0,47400.0,47750.0,19751494],['2016-03-04 00:00:00',46850.0,46950.0,46350.0,46350.0,17433532],['2016-03-05 00:00:00',47000.0,47100.0,46550.0,46700.0,17522984],['2016-03-06 00:00:00',46800.0,47100.0,46050.0,46500.0,30226088],['2016-03-07 00:00:00',47350.0,47900.0,47250.0,47750.0,25317806],['2016-03-08 00:00:00',48150.0,48750.0,47350.0,47350.0,46703483],['2016-03-09 00:00:00',47350.0,47750.0,47050.0,47300.0,44974435],['2016-03-10 00:00:00',46950.0,47100.0,46600.0,46700.0,55071490],['2016-03-11 00:00:00',46350.0,46450.0,45300.0,45350.0,59494463],['2016-03-12 00:00:00',46650.0,47350.0,46200.0,46400.0,58521740],['2016-03-13 00:00:00',47450.0,50950.0,44500.0,49250.0,275737207],['2016-03-14 00:00:00',50800.0,51150.0,50700.0,50700.0,42230799],['2016-03-15 00:00:00',50300.0,50400.0,49850.0,50000.0,33310264],['2016-03-16 00:00:00',49800.0,49850.0,49300.0,49300.0,28593221],['2016-03-17 00:00:00',49350.0,49750.0,48550.0,49000.0,47055884],['2016-03-18 00:00:00',47700.0,47900.0,47200.0,47300.0,24808475],['2016-03-19 00:00:00',46400.0,47000.0,46300.0,46950.0,46699667],['2016-03-20 00:00:00',47350.0,47500.0,46600.0,46800.0,33508665],['2016-03-21 00:00:00',47250.0,48200.0,47200.0,47900.0,35191085],['2016-03-22 00:00:00',47900.0,48000.0,47500.0,47950.0,43785480],['2016-03-23 00:00:00',49350.0,50500.0,49200.0,50500.0,25503914],['2016-03-24 00:00:00',50500.0,50900.0,50350.0,50600.0,14256871],['2016-03-25 00:00:00',50850.0,51100.0,50450.0,50600.0,15028778],['2016-03-26 00:00:00',50100.0,50500.0,49700.0,50500.0,18856832],['2016-03-27 00:00:00',50800.0,51150.0,50550.0,50550.0,28192014],['2016-03-28 00:00:00',50500.0,50800.0,50000.0,50000.0,21691426],['2016-03-29 00:00:00',50350.0,50850.0,50100.0,50250.0,29170854],['2016-03-30 00:00:00',51200.0,51750.0,50500.0,50500.0,26376528],['2016-03-31 00:00:00',50800.0,51100.0,50550.0,50600.0,14181628],['2016-04-01 00:00:00',50850.0,51150.0,50400.0,50800.0,24129831],['2016-04-02 00:00:00',50850.0,50950.0,50300.0,50650.0,31438778],['2016-04-03 00:00:00',50350.0,50400.0,49500.0,49500.0,44945164],['2016-04-04 00:00:00',48500.0,48650.0,47900.0,48250.0,13236912],['2016-04-05 00:00:00',48200.0,48600.0,48000.0,48250.0,20760494],['2016-04-06 00:00:00',48700.0,49150.0,48500.0,48900.0,20423325],['2016-04-07 00:00:00',49250.0,49350.0,48400.0,48500.0,31665074],['2016-04-08 00:00:00',48500.0,48950.0,48350.0,48500.0,26191077],['2016-04-09 00:00:00',49200.0,49400.0,48050.0,48250.0,26662411],['2016-04-10 00:00:00',47950.0,48250.0,47450.0,47450.0,20458111],['2016-04-11 00:00:00',47300.0,47700.0,47050.0,47500.0,28694763],['2016-04-12 00:00:00',47800.0,48400.0,47500.0,48350.0,26845674],['2016-04-13 00:00:00',48200.0,48850.0,48200.0,48800.0,20794189],['2016-04-14 00:00:00',48750.0,48900.0,48350.0,48350.0,20158499],['2016-04-15 00:00:00',48400.0,49200.0,48400.0,49000.0,20714493],['2016-04-16 00:00:00',48350.0,49350.0,48350.0,49250.0,36282101],['2016-04-17 00:00:00',49450.0,49950.0,49250.0,49400.0,30076053],['2016-04-18 00:00:00',50150.0,50800.0,50000.0,50550.0,29835390],['2016-04-19 00:00:00',51500.0,53100.0,50900.0,51800.0,37546864],['2016-04-20 00:00:00',51800.0,52200.0,51600.0,52000.0,16949144],['2016-04-21 00:00:00',52200.0,53450.0,52050.0,52900.0,30671689],['2016-04-22 00:00:00',52650.0,53200.0,52500.0,53000.0,29334848],['2016-04-23 00:00:00',52250.0,52300.0,51050.0,51600.0,19738646],['2016-04-24 00:00:00',51450.0,52200.0,51400.0,51600.0,20934234],['2016-04-25 00:00:00',52150.0,52450.0,51950.0,52300.0,23426317],['2016-04-26 00:00:00',52900.0,52900.0,51650.0,51850.0,60318567],['2016-04-27 00:00:00',50650.0,50850.0,50100.0,50750.0,25004705],['2016-04-28 00:00:00',50750.0,50800.0,49500.0,49500.0,47902965],['2016-04-29 00:00:00',48950.0,49100.0,48400.0,49100.0,21942259],['2016-04-30 00:00:00',49300.0,49400.0,49100.0,49200.0,20784278],['2016-05-01 00:00:00',49000.0,49500.0,48900.0,49400.0,37866945],['2016-05-02 00:00:00',48050.0,48100.0,46700.0,47000.0,42283448],['2016-05-03 00:00:00',45950.0,46200.0,45900.0,46000.0,18322088],['2016-05-04 00:00:00',46200.0,46500.0,45750.0,45950.0,30310937],['2016-05-05 00:00:00',46000.0,46000.0,45050.0,45450.0,20757579],['2016-05-06 00:00:00',45800.0,46100.0,45650.0,45800.0,24693527],['2016-05-07 00:00:00',45950.0,46150.0,45700.0,46100.0,42227380],['2016-05-08 00:00:00',46750.0,47950.0,46650.0,47950.0,48264822],['2016-05-09 00:00:00',47950.0,48500.0,47850.0,48450.0,29888783],['2016-05-10 00:00:00',48400.0,48850.0,48350.0,48500.0,26596982],['2016-05-11 00:00:00',49050.0,49250.0,48350.0,48500.0,29039907],['2016-05-12 00:00:00',48600.0,48800.0,48150.0,48800.0,27907888],['2016-05-13 00:00:00',48800.0,49150.0,48650.0,49000.0,27542254],['2016-05-14 00:00:00',49500.0,49600.0,49200.0,49500.0,17432504],['2016-05-15 00:00:00',50000.0,50500.0,49950.0,50500.0,12380727],['2016-05-16 00:00:00',50300.0,50650.0,50150.0,50400.0,11813300],['2016-05-17 00:00:00',50000.0,50350.0,49900.0,50200.0,14658126],['2016-05-18 00:00:00',50450.0,50700.0,50200.0,50500.0,11538725],['2016-05-19 00:00:00',49850.0,50400.0,49800.0,50250.0,13396144],['2016-05-20 00:00:00',50200.0,50500.0,50100.0,50500.0,15635270],['2016-05-21 00:00:00',50700.0,51000.0,50500.0,50500.0,35826740],['2016-05-22 00:00:00',50300.0,50600.0,49800.0,49800.0,47828976],['2016-05-23 00:00:00',50200.0,50650.0,49800.0,50150.0,24931258],['2016-05-24 00:00:00',50050.0,50500.0,49400.0,49400.0,31118048],['2016-05-25 00:00:00',49250.0,49750.0,49150.0,49550.0,19506044],['2016-05-26 00:00:00',49650.0,50550.0,49400.0,50050.0,24550679],['2016-05-27 00:00:00',50250.0,50350.0,49650.0,49650.0,18674180],['2016-05-28 00:00:00',49650.0,49950.0,49450.0,49900.0,16025139],['2016-05-29 00:00:00',50900.0,51300.0,50450.0,50500.0,34211835],['2016-05-30 00:00:00',50050.0,50150.0,49100.0,49600.0,23613890],['2016-05-31 00:00:00',49650.0,50200.0,49350.0,50050.0,17829975],['2016-06-01 00:00:00',49550.0,49800.0,48900.0,49000.0,28829644],['2016-06-02 00:00:00',47750.0,48100.0,47650.0,48050.0,42846538],['2016-06-03 00:00:00',48700.0,48850.0,48400.0,48600.0,24572792],['2016-06-04 00:00:00',49150.0,49700.0,48700.0,49050.0,28484295],['2016-06-05 00:00:00',49150.0,51250.0,48600.0,50350.0,49541286],['2016-06-06 00:00:00',50250.0,50350.0,49850.0,50200.0,17092831],['2016-06-07 00:00:00',50950.0,51150.0,50600.0,50850.0,15937737],['2016-06-08 00:00:00',49500.0,50300.0,49400.0,50100.0,16038893],['2016-06-09 00:00:00',50350.0,50650.0,50100.0,50250.0,14928926],['2016-06-10 00:00:00',50250.0,50350.0,49500.0,49600.0,27861491],['2016-06-11 00:00:00',48100.0,48150.0,47800.0,47950.0,44149323],['2016-06-12 00:00:00',49500.0,52350.0,49400.0,52350.0,57492829],['2016-06-13 00:00:00',52350.0,52750.0,52150.0,52300.0,14190147],['2016-06-14 00:00:00',52000.0,52350.0,51950.0,52150.0,27031116],['2016-06-15 00:00:00',52250.0,52550.0,51900.0,52550.0,36916320],['2016-06-16 00:00:00',54150.0,54650.0,53800.0,54000.0,19482291],['2016-06-17 00:00:00',54650.0,55000.0,54450.0,54800.0,20814857],['2016-06-18 00:00:00',53350.0,53600.0,52800.0,52900.0,22593012],['2016-06-19 00:00:00',52900.0,53300.0,52700.0,52950.0,25551210],['2016-06-20 00:00:00',51800.0,52500.0,51700.0,52500.0,28526653],['2016-06-21 00:00:00',53600.0,54200.0,53500.0,53700.0,23811323],['2016-06-22 00:00:00',52850.0,53100.0,52050.0,52700.0,30081814],['2016-06-23 00:00:00',51900.0,53200.0,51750.0,53100.0,49722566],['2016-06-24 00:00:00',53150.0,54100.0,53100.0,53650.0,36412124],['2016-06-25 00:00:00',54450.0,54550.0,53700.0,53800.0,35093407],['2016-06-26 00:00:00',54350.0,54650.0,54200.0,54350.0,46715135],['2016-06-27 00:00:00',56100.0,56500.0,56000.0,56300.0,23892235],['2016-06-28 00:00:00',56300.0,56450.0,55800.0,55900.0,33654823],['2016-06-29 00:00:00',57050.0,57600.0,56900.0,57000.0,21913006],['2016-06-30 00:00:00',56500.0,57200.0,56400.0,57000.0,23333645]]};
    
    this.drawChart(lvTestChart);
    // this.chartCtrl.importState(["Candle", [["InChartVol"],["InChartSMA",[60]],["InChartBB"]], [["RSI", [11], 100], ["MACD", [13,5,3], 125]]])
}

function setScroll()
{
    var curYPos = 0,curXPos = 0,curDown = false;
    var obj = document.body;
    obj.addEventListener('mousemove', function(e){
        // document.body.scrollTop: For Chrome, Safari and Opera
        // document.documentElement.scrollTop: Firefox and IE places the overflow at the <html> level, unless else is specified. Therefore, we use the documentElement property for these two browsers
        if(curDown == true)
            window.scrollTo(0, Math.max(document.body.scrollTop, document.documentElement.scrollTop) + (curYPos - e.pageY));
    });
    
    obj.addEventListener('mousedown', function(e){ curDown = true; curYPos = e.pageY;});
    obj.addEventListener('mouseup', function(e){ curDown = false; });
}

init();
console.log('TTLStockChartInitEnd');
})(window);